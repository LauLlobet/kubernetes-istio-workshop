<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy Microservices :: Kubernetes, Istio and Monitoring Workshop</title>
    <link rel="canonical" href="https://sfeir.github.com/kubernetes-istio-workshop/kubernetes-istio-workshop/1.0.0/istio/02_deploy-microservices.html">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="#">Kubernetes, Istio and Monitoring Workshop</a>
        <span class="separator">//</span>
        <a href="https://sfeir.github.com/kubernetes-istio-workshop">Docs</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Project</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>GitHub</strong></div>
            <a class="navbar-item" href="https://github.com/Sfeir/kubernetes-istio-workshop/">Istio workshop Repository</a>
            <a class="navbar-item" href="https://github.com/Sfeir/kubernetes-istio-workshop//issues">Istio workshop Issue Tracker</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/sfeir">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kubernetes-istio-workshop" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Kubernetes, Istio and Monitoring Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../welcome/welcome.html"><strong>Welcome</strong></a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../welcome/welcome.html#gcp">1. Google Cloud Platform</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../welcome/welcome.html#cloud-shell">2. Setup Cloud Shell</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Part 1 : Kubernetes</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/01_setup.html">1. Create cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/02_creating-and-managing-pods.html">2. Pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/03_monitoring-and-health-checks.html">3. Monitoring apps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/04_managing-application-configurations-and-secrets.html">4. ConfigMaps &amp; Secrets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/05_creating-and-managing-services.html">5. Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/06_creating-and-managing-deployments.html">6. Deployments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/07_rolling-out-updates.html">7. Rolling-upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/08_cleanup.html">8. Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Part 2 : Istio</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01_setup_gke.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01_setup_gke.html#create-cluster">Setup Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01_setup_istio.html#deploy-istio">Deploy Istio</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02_deploy-microservices.html">2. Deploy Microservices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#create-namespace">Create Namespace</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploy-microservices">Deploy Microservice</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#expose-customer">Expose customer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03_monitoring-tracing.html">3. Observability Tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_monitoring-tracing.html#monitoring">Monitoring and Tracing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_monitoring-tracing.html#grafana">Grafana</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_monitoring-tracing.html#prometheus">Prometheus</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_monitoring-tracing.html#jaeger">Jaeger</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03_monitoring-tracing-kiali.html">Kiali</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="03_monitoring-tracing-kiali.html#generatingdata">Generating sample data</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="03_monitoring-tracing-kiali.html#servicegraph">Service graph</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="03_monitoring-tracing-kiali.html#applications">Applications</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="03_monitoring-tracing-kiali.html#workloads">Workloads</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04_simple-routerules.html">4. Traffic Control</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04_simple-routerules.html#deployrecommendationv2">Deploy recommendation v2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04_simple-routerules.html#istiorouting">Changing Istio Routings</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="04_simple-routerules.html#alltorecommendationv2">All Users to recommendation v2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="04_simple-routerules.html#alltorecommendationv1">Al Users to recommendation v1</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="04_simple-routerules.html#alltorecommendationv1v2">All Users to recommendation v1 and v2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="04_simple-routerules.html#canarydeploymentrecommendation">Canary Deployment between v1 And v2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06_fault-injection.html">5. Fault injection</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06_fault-injection.html#503error">HTTP 503 Error</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06_fault-injection.html#delay">Delay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07_circuit-breaker.html">6. Service Resiliency</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06_fault-injection.html#retry">Retry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06_fault-injection.html#timeout">Timeout</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07_circuit-breaker.html#failfast">Fail Fast</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#nocircuitbreaker">No Circuit Breaker</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#circuitbreaker">Circuit Breaker</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07_circuit-breaker.html#poolejection">Pool Ejection</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#nofailinginstances">No Failing Instance</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#failinginstancesnopoolejection">Failing Instance No Pool Ejection</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#failinginstancespoolejection">Failing Instance Pool Ejection</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="07_circuit-breaker.html#circuitbreakerandpoolejection">Circuit Breaker + Pool Ejection</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">7. Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="10_mTLS.html">Mutual TLS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="end-user-authentication.html">End-user Authentication </a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rbac.html">RBAC</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Bonus</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="b1_rate-limiting.html#ratelimiting">Rate Limiting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05_advanced-routerules.html">Advanced Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05_advanced-routerules.html#traffic-steering">Traffic Steering</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05_advanced-routerules.html#loadbalancer">Load Balancer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="11_access-control.html#accesscontrol">Access Control</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11_access-control.html#whitelist">White List</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="11_access-control.html#blacklist">Black List</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="08_egress.html">Egress</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kubernetes, Istio and Monitoring Workshop</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Kubernetes, Istio and Monitoring Workshop</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Kubernetes, Istio and Monitoring Workshop</a></li>
    <li><strong>Part 2 : Istio</strong></li>
    <li><a href="02_deploy-microservices.html">2. Deploy Microservices</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///repo/src/documentation/modules/istio/pages/02_deploy-microservices.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page">Deploy Microservices</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We will deploy our microservice in a dedicated namespace called <code>workshop</code>.</p>
</div>
<div class="paragraph">
<p>So you will first create the namespace, then you&#8217;ll enable automatic Istio sidecar injection. Finally, you will deploy the 3 microservices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-namespace"><a class="anchor" href="#create-namespace"></a>Create Namespace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the namespace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl create namespace workshop

namespace/workshop created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable sidecar injection</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl label namespace workshop istio-injection=enabled

namespace/workshop labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set this namespace as the default one, it will saves you typing the namespace every <code>kubectl</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl config set-context $(kubectl config current-context) --namespace=workshop

Context "gke_$PROJECT_ID_europe-west1-b_istio-workshop" modified.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-microservices"><a class="anchor" href="#deploy-microservices"></a>Deploy Microservice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Start deploying the microservices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f manifests/kubernetes/customer.yml
kubectl apply -f manifests/kubernetes/preference-v1.yml
kubectl apply -f manifests/kubernetes/recommendation-v1.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until the status is <code>Running</code> and there are <code>2/2</code> pods in the <code>READY</code> column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl get pod

NAME                                READY   STATUS    RESTARTS   AGE
customer-7986477758-frtkq           2/2     Running   0          8m5s
preference-v1-7479c8cc65-9mc42      2/2     Running   0          78s
recommendation-v1-54ccbb466-8pprm   2/2     Running   0          76s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>2/2</code>. It indicates that there is 2 containers into the pod. As you might have guessed, the first container is our microservice (customer, preference or recommendation), the second container is the injected one by Istio which is <code>istio-proxy</code> (in fact it&#8217;s Envoy). From now on, the proxy will capture and control all the traffic from/to the container.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see the logs for <code>customer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl logs -l app=customer -c customer

...
2019-09-14 17:20:06.571  INFO 1 --- [           main] c.r.d.d.customer.CustomerApplication     : Started CustomerApplication in 22.571 seconds (JVM running for 24.331)
2019-09-14 17:20:15.213  INFO 1 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring FrameworkServlet 'dispatcherServlet'
2019-09-14 17:20:15.215  INFO 1 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : FrameworkServlet 'dispatcherServlet': initialization started
2019-09-14 17:20:15.331  INFO 1 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : FrameworkServlet 'dispatcherServlet': initialization completed in 116 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also see the logs of the proxy if wish:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl logs -l app=customer -c istio-proxy

2019-09-14T17:19:42.663151Z     info    watching /etc/certs for changes
2019-09-14T17:19:42.663158Z     info    Received new config, resetting budget
2019-09-14T17:19:42.663161Z     info    Reconciling retry (budget 10)
2019-09-14T17:19:42.663168Z     info    Epoch 0 starting
2019-09-14T17:19:42.683283Z     info    Envoy command: [-c /etc/istio/proxy/envoy-rev0.json --restart-epoch 0 --drain-time-s 45 --parent-shutdown-time-s 60 --service-cluster customer.workshop --service-node sidecar~10.16.0.12~customer-7986477758-frtkq.workshop~workshop.svc.cluster.local --max-obj-name-len 189 --local-address-ip-version v4 --allow-unknown-fields -l warning --component-log-level misc:error --concurrency 2]
[2019-09-14 17:19:42.726][12][warning][config] [bazel-out/k8-opt/bin/external/envoy/source/common/config/_virtual_includes/grpc_stream_lib/common/config/grpc_stream.h:86] gRPC config stream closed: 14, no healthy upstream
[2019-09-14 17:19:42.726][12][warning][config] [bazel-out/k8-opt/bin/external/envoy/source/common/config/_virtual_includes/grpc_stream_lib/common/config/grpc_stream.h:49] Unable to establish new stream
[2019-09-14 17:19:44.257][12][warning][filter] [src/envoy/http/authn/http_filter_factory.cc:102] mTLS PERMISSIVE mode is used, connection can be either plaintext or TLS, and client cert can be omitted. Please consider to upgrade to mTLS STRICT mode for more secure configuration that only allows TLS connection with client cert. See https://istio.io/docs/tasks/security/mtls-migration/
[2019-09-14 17:19:44.259][12][warning][filter] [src/envoy/http/authn/http_filter_factory.cc:102] mTLS PERMISSIVE mode is used, connection can be either plaintext or TLS, and client cert can be omitted. Please consider to upgrade to mTLS STRICT mode for more secure configuration that only allows TLS connection with client cert. See https://istio.io/docs/tasks/security/mtls-migration/
2019-09-14T17:19:44.897925Z     info    Envoy proxy is ready</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expose-customer"><a class="anchor" href="#expose-customer"></a>Expose customer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it&#8217;s time to make some calls to our microservices. The frontend service (the service the users will interact with), is the <code>customer</code>.</p>
</div>
<div class="paragraph">
<p>To call this service externally, you need to make it accessible from outside of your Kubernetes cluster. With Istio we use a <a href="https://istio.io/docs/concepts/traffic-management/#gateways">Gateway</a> for this purpose.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s get started</p>
</div>
<div class="paragraph">
<p>1- Define the ingress gateway for the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f manifests/istio/gateway/customer-gateway.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following definition, every hit to <code>/</code> (<code>prefix : /</code>) will be routed to the service customer (<code>host: customer</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: customer-gateway
spec:
  selector:
    istio: ingressgateway # use istio default controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: customer-gateway
spec:
  hosts:
  - "*"
  gateways:
  - customer-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: customer
        port:
          number: 8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>2- Confirm the gateway has been created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get gateway</code></pre>
</div>
</div>
<div class="paragraph">
<p>3- set the <code>GATEWAY_IP</code> variables for accessing the gateway:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export GATEWAY_IP=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.status.loadBalancer.ingress[0].ip}')</code></pre>
</div>
</div>
<div class="paragraph">
<p>4- Then test the customer endpoint. Because of the route defined in the <code>VirtualService</code> (that we will see later), the URL of the customer service is mapped to the root URL of the gateway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export customer=$GATEWAY_IP

curl $customer</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following message</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">customer =&gt; preference =&gt; recommendation v1 from '99634814-sf4cl': 1</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Congratulations, you finished the lab !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="03_monitoring-tracing.html" class="page">Next &gt;</a></p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This content is brought to you by <a href="http://sfeir.com">Sfeir</a></p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
